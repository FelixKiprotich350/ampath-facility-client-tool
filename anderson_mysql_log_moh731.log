2026-02-06T19:56:07.393833Z	 1961 Query	SET autocommit=0
2026-02-06T19:56:07.394717Z	 1961 Query	select a.patient_id
from (select e.patient_id, hts_date, delivery_date
      from kenyaemr_etl.etl_mch_enrollment e
               left join (SELECT v.patient_id, v.delivery_date
                          FROM kenyaemr_etl.etl_mch_postnatal_visit v
                          WHERE DATE(v.visit_date) BETWEEN DATE('2025-10-01 00:00:00') AND DATE('2025-10-31 00:00:00')
                            and final_test_result = 'Positive'
                            and TIMESTAMPDIFF(WEEK, v.delivery_date, DATE(v.visit_date)) <= 6
                          GROUP BY v.patient_id) v
                         on e.patient_id = v.patient_id
               left join (select t.patient_id, max(t.visit_date) as hts_date
                          from kenyaemr_etl.etl_hts_test t
                          where t.hts_entry_point = 1623
                            and DATE(t.visit_date) BETWEEN DATE('2025-10-01 00:00:00') AND DATE('2025-10-31 00:00:00')
                          group by patient_id) t
                         on v.patient_id = t.patient_id
      where ((v.patient_id is not null) or
             (t.patient_id is not null and TIMESTAMPDIFF(WEEK, DATE(delivery_date), DATE(hts_date)) <= 6))
      group by e.patient_id) a
2026-02-06T19:56:07.395697Z	 1961 Query	commit
2026-02-06T19:56:07.475352Z	 1961 Query	SET autocommit=0
2026-02-06T19:56:07.476883Z	 1961 Query	select a.patient_id
from (select e.patient_id, hts_date, delivery_date
      from kenyaemr_etl.etl_mch_enrollment e
               left join (SELECT v.patient_id, v.delivery_date
                          FROM kenyaemr_etl.etl_mch_postnatal_visit v
                          WHERE DATE(v.visit_date) BETWEEN DATE('2025-10-01 00:00:00') AND DATE('2025-10-31 00:00:00')
                            and final_test_result = 'Positive'
                            and TIMESTAMPDIFF(WEEK, v.delivery_date, DATE(v.visit_date)) > 6
                            and TIMESTAMPDIFF(MONTH, v.delivery_date, DATE(v.visit_date)) <= 6
                          GROUP BY v.patient_id) v
                         on e.patient_id = v.patient_id
               left join (select t.patient_id, max(t.visit_date) as hts_date
                          from kenyaemr_etl.etl_hts_test t
                          where t.hts_entry_point = 1623
                            and DATE(t.visit_date) BETWEEN DATE('2025-10-01 00:00:00') AND DATE('2025-10-31 00:00:00')
                          group by patient_id) t
                         on v.patient_id = t.patient_id
      where ((v.patient_id is not null) or
             (t.patient_id is not null and TIMESTAMPDIFF(WEEK, DATE(delivery_date), DATE(hts_date)) > 6) and
             TIMESTAMPDIFF(MONTH, v.delivery_date, DATE(hts_date)) <= 6)
      group by e.patient_id) a
2026-02-06T19:56:07.477836Z	 1961 Query	commit
2026-02-06T19:56:07.566837Z	 1961 Query	SET autocommit=0
2026-02-06T19:56:07.567504Z	 1961 Query	select e.patient_id
from kenyaemr_etl.etl_mch_enrollment e
         inner join kenyaemr_etl.etl_mch_antenatal_visit v on e.patient_id = v.patient_id
         left join (select patient_id,
                           min(date_started) as date_started_art
                    from kenyaemr_etl.etl_drug_event d
                    where program = 'HIV'
                      and d.date_started <= date('2025-10-31 00:00:00')
                    GROUP BY patient_id) d on v.patient_id = d.patient_id
where date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and v.anc_visit_number = 1
  and (coalesce(date(e.ti_date_started_art), date(d.date_started_art)) < date(v.visit_date))
2026-02-06T19:56:07.569085Z	 1961 Query	commit
2026-02-06T19:56:07.580426Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:07.581113Z	 1962 Query	select v.patient_id
from kenyaemr_etl.etl_mch_antenatal_visit v
where v.prophylaxis_given in (105281, 74250)
  and date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:07.581702Z	 1962 Query	commit
2026-02-06T19:56:07.608747Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:07.609314Z	 1962 Query	select v.patient_id
from kenyaemr_etl.etl_mchs_delivery v
where v.mother_started_haart_at_maternity = 1065
  and v.mother_on_haart_during_anc != 1065
  and date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:07.609658Z	 1962 Query	commit
2026-02-06T19:56:07.675399Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:07.676276Z	 1962 Query	select p.patient_id
from kenyaemr_etl.etl_mch_postnatal_visit p
         left join kenyaemr_etl.etl_hts_test t
                   on p.patient_id = t.patient_id and p.visit_date = t.visit_date and t.final_test_result = 'Positive'
         left join (select e.patient_id, min(e.date_started) as date_started
                    from kenyaemr_etl.etl_drug_event e
                    where date(e.date_started) <= date('2025-10-31 00:00:00')
                      and e.program = 'HIV'
                    group by e.patient_id) e
                   on p.patient_id = e.patient_id and p.visit_date = e.date_started
where p.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and ((p.final_test_result = 'Positive' and p.mother_haart_given = 1065 and
        timestampdiff(WEEK, date(p.delivery_date), date(p.visit_date)) between 0 and 6) or
       (t.patient_id is not null and
        ((timestampdiff(WEEK, date(p.delivery_date), date(p.visit_date)) between 0 and 6 and
          p.mother_haart_given = 1065) or (e.patient_id is not null
            and timestampdiff(WEEK, date(p.delivery_date), date(e.date_started)) between 0 and 6))))
2026-02-06T19:56:07.677253Z	 1962 Query	commit
2026-02-06T19:56:07.758137Z	 1961 Query	SET autocommit=0
2026-02-06T19:56:07.760247Z	 1961 Query	select p.patient_id
from kenyaemr_etl.etl_mch_postnatal_visit p
         left join kenyaemr_etl.etl_hts_test t
                   on p.patient_id = t.patient_id and p.visit_date = t.visit_date and t.final_test_result = 'Positive'
         left join (select e.patient_id, min(e.date_started) as date_started
                    from kenyaemr_etl.etl_drug_event e
                    where date(e.date_started) <= date('2025-10-31 00:00:00')
                      and e.program = 'HIV'
                    group by e.patient_id) e
                   on p.patient_id = e.patient_id and p.visit_date = e.date_started
where p.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and ((p.final_test_result = 'Positive' and p.mother_haart_given = 1065 and
        timestampdiff(WEEK, date(p.delivery_date), date(p.visit_date)) between 6 and 24) or
       (t.patient_id is not null and
        ((timestampdiff(WEEK, date(p.delivery_date), date(p.visit_date)) between 6 and 24 and
          p.mother_haart_given = 1065) or (e.patient_id is not null
            and timestampdiff(WEEK, date(p.delivery_date), date(e.date_started)) between 6 and 24))))
2026-02-06T19:56:07.761069Z	 1961 Query	commit
2026-02-06T19:56:07.860071Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:07.862117Z	 1962 Query	select v.patient_id
from kenyaemr_etl.etl_mch_antenatal_visit v
where date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and v.hepatitis_b_screening in (664, 703)
2026-02-06T19:56:07.862645Z	 1962 Query	commit
2026-02-06T19:56:07.874731Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:07.876200Z	 1962 Query	select v.patient_id
from kenyaemr_etl.etl_mch_antenatal_visit v
where date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and v.hepatitis_b_screening = 703
2026-02-06T19:56:07.877015Z	 1962 Query	commit 
2026-02-06T19:56:08.685648Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:08.686246Z	 1962 Query	select v.patient_id
from kenyaemr_etl.etl_mch_antenatal_visit v
         inner join kenyaemr_etl.etl_mch_enrollment en on en.patient_id = v.patient_id
where (v.baby_nvp_dispensed = 80586
   or v.baby_azt_dispensed = 160123)
    and date(v.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:08.686733Z	 1962 Query	commit
2026-02-06T19:56:08.706596Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:08.707497Z	 1962 Query	select r.person_b as child
from openmrs.relationship r
inner join kenyaemr_etl.etl_mchs_delivery d on d.patient_id = r.person_a and r.relationship = 3
and
                                         (d.baby_nvp_dispensed = 1
                                             or d.baby_azt_dispensed = 1)
and coalesce(date(d.date_of_delivery),date(d.visit_date)) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
left join (select e.patient_id,
            max(e.visit_date)                                                    as latest_enrollment,
            v.latest_anc_with_prohylaxis,
            mid(max(concat(e.visit_date, coalesce(e.lmp, e.lmp_estimated))), 11) as lmp_date,
            timestampdiff(WEEK,
                          mid(max(concat(e.visit_date, coalesce(e.lmp, e.lmp_estimated))), 11), date('2025-10-31 00:00:00'))
     from kenyaemr_etl.etl_mch_enrollment e
              inner join (select v.patient_id, max(v.visit_date) latest_anc_with_prohylaxis
                          from kenyaemr_etl.etl_mch_antenatal_visit v
                          where (v.baby_nvp_dispensed = 80586
                              or v.baby_azt_dispensed = 160123) and date(v.visit_date) <= date('2025-10-31 00:00:00')
                          group by v.patient_id) v
                         on e.patient_id = v.patient_id
     group by e.patient_id
     having latest_anc_with_prohylaxis >= latest_enrollment
        and timestampdiff(WEEK, lmp_date, date('2025-10-31 00:00:00')) <= 42) anc on r.person_a = anc.patient_id
where anc.patient_id is null
2026-02-06T19:56:08.732327Z	 1962 Query	commit
2026-02-06T19:56:08.745348Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:08.746115Z	 1962 Query	select r.person_b as child
from openmrs.relationship r
inner join kenyaemr_etl.etl_mch_postnatal_visit p on p.patient_id = r.person_a and r.relationship = 3
and
            (p.baby_nvp_dispensed = 80586
                or p.baby_azt_dispensed = 160123)
and p.infant_prophylaxis_timing = 1065
and date(p.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:08.746553Z	 1962 Query	commit
2026-02-06T19:56:08.771827Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:08.818466Z	 1962 Query	select d.patient_id
from kenyaemr_etl.etl_patient_demographics d
where d.dob between date_sub(date(DATE_SUB(date('2025-10-31 00:00:00'), INTERVAL DAYOFMONTH(date('2025-10-31 00:00:00')) - 1 DAY)),
                             interval 12 MONTH)
          and date_sub(date('2025-10-31 00:00:00'), interval 6 MONTH)
2026-02-06T19:56:08.837612Z	 1962 Query	commit
2026-02-06T19:56:08.843897Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:08.859255Z	 1962 Query	select f.patient_id from (Select e.patient_id, f.infant_feeding, group_concat(f.infant_feeding) as feeding, d.dob
from kenyaemr_etl.etl_hei_enrollment e
         inner join kenyaemr_etl.etl_hei_follow_up_visit f on e.patient_id = f.patient_id
         inner join kenyaemr_etl.etl_patient_demographics d on d.patient_id = e.patient_id
where date(e.visit_date) <= date('2025-10-31 00:00:00')
  and timestampdiff(month, d.dob, date(f.visit_date)) <= 6
group by e.patient_id
having find_in_set(6046, feeding) = 0
   and find_in_set(1595, feeding) = 0
   and find_in_set(5632, feeding) = 0
   and find_in_set(164478, feeding) = 0
   and find_in_set(5526, feeding) = 1)f
2026-02-06T19:56:08.862961Z	 1962 Query	commit
2026-02-06T19:56:08.875701Z	 1961 Query	SET autocommit=0

## This query reports HIV-exposed infants born in October 2023 (i.e., 24 months before the 
## reporting month of October 2025) who were enrolled in HEI at 0–18 months of age.
2026-02-06T19:56:08.876758Z	 1961 Query	select d.patient_id
from kenyaemr_etl.etl_patient_demographics d
         inner join kenyaemr_etl.etl_hei_enrollment e on d.patient_id = e.patient_id
where d.dob between date_sub(date(DATE_SUB(date('2025-10-31 00:00:00'), INTERVAL DAYOFMONTH(date('2025-10-31 00:00:00')) - 1 DAY)),
                             interval 24 MONTH)
          and date_sub(date('2025-10-31 00:00:00'), interval 24 MONTH) and timestampdiff(month, (d.dob), date(e.visit_date)) between 0 and 18
2026-02-06T19:56:08.877522Z	 1961 Query	commit
2026-02-06T19:56:08.884428Z	 1962 Query	SET autocommit=0

## HEI This query identifies HIV-exposed infants (≤24 months) who, by 31-Oct-2025, 
## were never breastfed but were either mixed fed, replacement fed, or not breastfed at all.
2026-02-06T19:56:08.885070Z	 1962 Query	select f.patient_id
from (Select e.patient_id, group_concat(f.infant_feeding) as feeding, d.dob
      from kenyaemr_etl.etl_hei_enrollment e
               inner join kenyaemr_etl.etl_hei_follow_up_visit f on e.patient_id = f.patient_id
               inner join kenyaemr_etl.etl_patient_demographics d on d.patient_id = e.patient_id
      where date(e.visit_date) <= date('2025-10-31 00:00:00')
        and timestampdiff(month, d.dob, date(f.visit_date)) <= 24
      group by e.patient_id
      having (find_in_set(6046, feeding) = 1
          or find_in_set(5632, feeding) = 1
          or find_in_set(5526, feeding) = 1)
         and find_in_set(1595, feeding) = 0
         and find_in_set(164478, feeding) = 0) f
2026-02-06T19:56:08.886393Z	 1962 Query	commit
2026-02-06T19:56:08.922286Z	 1961 Query	SET autocommit=0

## HIV-exposed infants (≤24 months old) - HEI
2026-02-06T19:56:08.922931Z	 1961 Query	select f.patient_id
from (Select e.patient_id, group_concat(f.infant_feeding) as feeding, d.dob
      from kenyaemr_etl.etl_hei_enrollment e
               inner join kenyaemr_etl.etl_hei_follow_up_visit f on e.patient_id = f.patient_id
               inner join kenyaemr_etl.etl_patient_demographics d on d.patient_id = e.patient_id
      where date(e.visit_date) <= date('2025-10-31 00:00:00')
        and timestampdiff(month, d.dob, date(f.visit_date)) <= 24
      group by e.patient_id
      having (find_in_set(1595, feeding) = 1
          or find_in_set(164478, feeding) = 1)
          and find_in_set(6046, feeding) = 0
          and find_in_set(5632, feeding) = 0
          and find_in_set(5526, feeding) = 0) f
2026-02-06T19:56:08.924324Z	 1961 Query	commit
2026-02-06T19:56:09.412867Z	 1961 Query	SET autocommit=0

##starting art
2026-02-06T19:56:09.413615Z	 1961 Query	select  net.patient_id
  from (
  select e.patient_id,e.date_started,
  d.visit_date as dis_date,
  if(d.visit_date is not null, 1, 0) as TOut,
  e.regimen, e.regimen_line, e.alternative_regimen,
  mid(max(concat(fup.visit_date,fup.next_appointment_date)),11) as latest_tca,
  max(if(enr.date_started_art_at_transferring_facility is not null and enr.facility_transferred_from is not null, 1, 0)) as TI_on_art,
  max(if(enr.transfer_in_date is not null, 1, 0)) as TIn,
  max(enr.patient_type) as latest_patient_type,
  max(fup.visit_date) as latest_vis_date
  from (select e.patient_id, min(e.date_started) as date_started,
  mid(min(concat(e.date_started,e.regimen_name)),11) as regimen,
  mid(min(concat(e.date_started,e.regimen_line)),11) as regimen_line,
  max(if(discontinued,1,0))as alternative_regimen
  from kenyaemr_etl.etl_drug_event e
   join kenyaemr_etl.etl_patient_demographics p on p.patient_id=e.patient_id
  where e.program = 'HIV'
  group by e.patient_id) e
  left outer join kenyaemr_etl.etl_patient_program_discontinuation d on d.patient_id=e.patient_id
  left outer join kenyaemr_etl.etl_hiv_enrollment enr on enr.patient_id=e.patient_id
  left outer join kenyaemr_etl.etl_patient_hiv_followup fup on fup.patient_id=e.patient_id
  where date(e.date_started) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  group by e.patient_id
  having TI_on_art=0 and latest_patient_type in (164144,160563,159833)
       )net
2026-02-06T19:56:09.426606Z	 1961 Query	commit
2026-02-06T19:56:09.774683Z	 1961 Query	SET autocommit=0

##curr on art
2026-02-06T19:56:09.775642Z	 1961 Query	select t.patient_id
from (select fup.visit_date,
             fup.patient_id,
             max(e.visit_date)                                                                as enroll_date,
             greatest(max(fup.visit_date), ifnull(max(d.visit_date), '0000-00-00'))           as latest_vis_date,
             greatest(mid(max(concat(fup.visit_date, fup.next_appointment_date)), 11),
                      ifnull(max(d.visit_date), '0000-00-00'))                                as latest_tca,
             d.patient_id                                                                     as disc_patient,
             d.effective_disc_date                                                            as effective_disc_date,
             max(d.visit_date)                                                                as date_discontinued,
             de.patient_id                                                                    as started_on_drugs
      from kenyaemr_etl.etl_patient_hiv_followup fup
               join kenyaemr_etl.etl_patient_demographics p on p.patient_id = fup.patient_id
               join kenyaemr_etl.etl_hiv_enrollment e on fup.patient_id=e.patient_id
                           left join kenyaemr_etl.etl_drug_event de
                          on e.patient_id = de.patient_id and de.program = 'HIV' and date(de.date_started) <= date('2025-10-31 00:00:00')
               left outer JOIN
           (select patient_id,
                   coalesce(date(effective_discontinuation_date), visit_date) visit_date,
                   max(date(effective_discontinuation_date)) as               effective_disc_date
            from kenyaemr_etl.etl_patient_program_discontinuation
            where date(visit_date) <= date('2025-10-31 00:00:00')
              and program_name = 'HIV'
            group by patient_id) d on d.patient_id = fup.patient_id
      where fup.visit_date <= date('2025-10-31 00:00:00')
      group by patient_id
      having (started_on_drugs is not null and started_on_drugs <> '')
         and (
          (
                  (timestampdiff(DAY, date(latest_tca), date('2025-10-31 00:00:00')) <= 30 and
                   ((date(d.effective_disc_date) > date('2025-10-31 00:00:00') or date(enroll_date) > date(d.effective_disc_date)) or
                    d.effective_disc_date is null))
                  and
                  (date(latest_vis_date) >= date(date_discontinued) or date(latest_tca) >= date(date_discontinued) or
                   disc_patient is null)
              )
          )) t
2026-02-06T19:56:10.416476Z	 1961 Query	commit
2026-02-06T19:56:10.595348Z	 1961 Query	SET autocommit=0

##tb screening
2026-02-06T19:56:10.595851Z	 1961 Query	select tb.patient_id
from kenyaemr_etl.etl_tb_screening tb
where tb.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and tb.person_present = 978
  and tb.resulting_tb_status in (1660, 1662, 142177)
2026-02-06T19:56:10.597466Z	 1961 Query	commit
2026-02-06T19:56:10.922616Z	 1961 Query	SET autocommit=0
2026-02-06T19:56:10.923130Z	 1961 Query	select patient_id
from kenyaemr_etl.etl_ipt_initiation
where visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
 and voided = 0
2026-02-06T19:56:10.924277Z	 1961 Query	commit
2026-02-06T19:56:11.114411Z	 1968 Query	SET autocommit=0

## Stable ART patients (eligible for multi-month scripting or differentiated care)
2026-02-06T19:56:11.115357Z	 1968 Query	select a.patient_id
from (select f.patient_id,
             mid(max(concat(f.visit_date, f.stability)), 11) as stability
      from kenyaemr_etl.etl_patient_hiv_followup f
      where f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.stability = 1
2026-02-06T19:56:11.116614Z	 1968 Query	commit
2026-02-06T19:56:11.125899Z	 1961 Query	SET autocommit=0

## Non-Stable ART patients
2026-02-06T19:56:11.126491Z	 1961 Query	select a.patient_id
from (select f.patient_id,
             mid(max(concat(f.visit_date, f.stability)), 11) as stability
      from kenyaemr_etl.etl_patient_hiv_followup f
      where f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.stability = 2
2026-02-06T19:56:11.127562Z	 1961 Query	commit
2026-02-06T19:56:11.137061Z	 1961 Query	SET autocommit=0


## differentiated community ART patients
2026-02-06T19:56:11.137769Z	 1961 Query	select a.patient_id
from (select f.patient_id,
             mid(max(concat(f.visit_date, f.differentiated_care)), 11) as differentiated_care_setting
      from kenyaemr_etl.etl_patient_hiv_followup f
      where f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.differentiated_care_setting = 163488
2026-02-06T19:56:11.139161Z	 1961 Query	commit
2026-02-06T19:56:11.149360Z	 1968 Query	SET autocommit=0

## differentiated Health facility ART patients
2026-02-06T19:56:11.149969Z	 1968 Query	select a.patient_id
from (select f.patient_id,
             mid(max(concat(f.visit_date, f.differentiated_care)), 11) as differentiated_care_setting
      from kenyaemr_etl.etl_patient_hiv_followup f
      where f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.differentiated_care_setting = 1537
2026-02-06T19:56:11.151051Z	 1968 Query	commit

2026-02-06T19:56:11.167981Z	 1961 Query	select f.patient_id from kenyaemr_etl.etl_patient_hiv_followup f where f.person_present = 978 and f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:11.168825Z	 1961 Query	commit
2026-02-06T19:56:11.176378Z	 1968 Query	SET autocommit=0


2026-02-06T19:56:11.177234Z	 1968 Query	select a.patient_id
from (select t.patient_id, mid(max(concat(t.visit_date, t.nutritional_status)), 11) as nutritional_status
      from kenyaemr_etl.etl_patient_triage t
      where t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.nutritional_status in (164131, 163302)
2026-02-06T19:56:11.179486Z	 1968 Query	commit
2026-02-06T19:56:11.205933Z	 1968 Query	SET autocommit=0

## This query reports HIV patients who were pregnant or breastfeeding at 
## their latest follow-up visit in October 2025.
2026-02-06T19:56:11.206526Z	 1968 Query	select a.patient_id
from (select f.patient_id,
             mid(max(concat(f.visit_date, f.pregnancy_status)), 11) as pregnancy_status,
             mid(max(concat(f.visit_date, f.breastfeeding)), 11)    as breastfeeding
      from kenyaemr_etl.etl_patient_hiv_followup f
      where f.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where (a.breastfeeding = 1065 or a.pregnancy_status = 1065)
2026-02-06T19:56:11.207509Z	 1968 Query	commit
2026-02-06T19:56:11.235264Z	 1961 Query	SET autocommit=0


2026-02-06T19:56:11.235830Z	 1961 Query	select a.patient_id
from (select t.patient_id, mid(max(concat(t.visit_date, t.nutritional_status)), 11) as nutritional_status
      from kenyaemr_etl.etl_patient_triage t
      where t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.nutritional_status in (163303, 123815)
2026-02-06T19:56:11.236705Z	 1961 Query	commit
2026-02-06T19:56:11.296251Z	 1968 Query	SET autocommit=0
2026-02-06T19:56:11.296951Z	 1968 Query	select a.patient_id
from (select t.patient_id, mid(max(concat(t.visit_date, t.nutritional_intervention)), 11) as nutritional_intervention
      from kenyaemr_etl.etl_patient_triage t
      where t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.nutritional_intervention = 161650
2026-02-06T19:56:11.297685Z	 1968 Query	commit
2026-02-06T19:56:11.426724Z	 1968 Query	SET autocommit=0
2026-02-06T19:56:11.427350Z	 1968 Query	select a.patient_id
from (select t.patient_id, mid(max(concat(t.visit_date, t.nutritional_intervention)), 11) as nutritional_intervention
      from kenyaemr_etl.etl_patient_triage t
      where t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
      group by patient_id) a
where a.nutritional_intervention = 159854
2026-02-06T19:56:11.428006Z	 1968 Query	commit
2026-02-06T19:56:11.492400Z	 1968 Query	SET autocommit=0
2026-02-06T19:56:11.493010Z	 1968 Query	select  e.patient_id  from kenyaemr_etl.etl_tb_enrollment e  join kenyaemr_etl.etl_patient_demographics p on p.patient_id=e.patient_id  where date(e.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:11.494542Z	 1968 Query	commit
2026-02-06T19:56:11.509215Z	 1968 Query	SET autocommit=0

## This query reports HIV-positive patients (diagnosed before October 2025) who were newly 
## enrolled in TB care during October 2025.
2026-02-06T19:56:11.509842Z	 1968 Query	select e.patient_id
from kenyaemr_etl.etl_tb_enrollment e
         inner join kenyaemr_etl.etl_hiv_enrollment he on he.patient_id = e.patient_id and
                                                          coalesce(date(he.date_confirmed_hiv_positive),
                                                                   date(he.visit_date)) < date('2025-10-01 00:00:00')
where date(e.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:11.510346Z	 1968 Query	commit
2026-02-06T19:56:11.510510Z	 1968 Query	set session transaction read write
2026-02-06T19:56:11.518605Z	 1968 Query	SET autocommit=0
2026-02-06T19:56:11.519166Z	 1968 Query	select e.patient_id
from kenyaemr_etl.etl_tb_enrollment e
         inner join kenyaemr_etl.etl_hts_test h
                    on e.patient_id = h.patient_id and h.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and
                       h.test_type = 1 and h.final_test_result = 'Positive'
where date(e.visit_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
2026-02-06T19:56:11.519709Z	 1968 Query	commit
2026-02-06T19:56:12.355290Z	 1962 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_circumcision_procedure e
         left join (select h.patient_id, h.hiv_test_date
                    from kenyaemr_etl.etl_vmmc_medical_history h
                    where h.hiv_status = 703
                      and date(h.hiv_test_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')) h
                   on e.patient_id = h.patient_id
         left join (select t.patient_id,t.visit_date
                    from kenyaemr_etl.etl_hts_test t
                    where t.final_test_result = 'Positive'
                      and t.test_type = 1
                      and t.hts_entry_point = 162223
                      and t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')) t on e.patient_id = t.patient_id
where e.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and ((h.patient_id is not null and e.visit_date >= date(h.hiv_test_date)) or (t.patient_id is not null and e.visit_date >= date(t.visit_date)))

2026-02-06T19:56:12.442028Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:12.442636Z	 1962 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_circumcision_procedure e
         left join (select h.patient_id, h.hiv_test_date
                    from kenyaemr_etl.etl_vmmc_medical_history h
                    where h.hiv_status = 664
                      and date(h.hiv_test_date) between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')) h
                   on e.patient_id = h.patient_id
         left join (select t.patient_id,t.visit_date
                    from kenyaemr_etl.etl_hts_test t
                    where t.final_test_result = 'Negative'
                      and t.hts_entry_point = 162223
                      and t.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')) t on e.patient_id = t.patient_id
where e.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and ((h.patient_id is not null and e.visit_date >= date(h.hiv_test_date)) or (t.patient_id is not null and e.visit_date >= date(t.visit_date)))
2026-02-06T19:56:12.443028Z	 1962 Query	commit
2026-02-06T19:56:12.443166Z	 1962 Query	set session transaction read write
2026-02-06T19:56:12.628729Z	 1967 Query	SET autocommit=0
2026-02-06T19:56:12.629356Z	 1967 Query	select e.patient_id from kenyaemr_etl.etl_vmmc_enrolment e inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and c.circumcision_method = 167119
2026-02-06T19:56:12.630530Z	 1967 Query	commit
2026-02-06T19:56:12.949114Z	 1967 Query	SET autocommit=0
2026-02-06T19:56:12.949565Z	 1967 Query	select e.patient_id from kenyaemr_etl.etl_vmmc_enrolment e inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and c.circumcision_method = 167120
2026-02-06T19:56:12.949876Z	 1967 Query	commit
2026-02-06T19:56:13.039557Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:13.040099Z	 1962 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_enrolment e
         inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
         inner join kenyaemr_etl.etl_adverse_events a on e.patient_id = a.patient_id and a.form = 'vmmc-procedure'
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and a.severity = 1499
group by e.patient_id
2026-02-06T19:56:13.041931Z	 1962 Query	commit
2026-02-06T19:56:13.042177Z	 1962 Query	set session transaction read write
2026-02-06T19:56:13.052431Z	 1967 Query	SET autocommit=0
2026-02-06T19:56:13.053162Z	 1967 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_enrolment e
         inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
         inner join kenyaemr_etl.etl_adverse_events a on e.patient_id = a.patient_id and a.form = 'vmmc-procedure'
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and a.severity = 1500
group by e.patient_id
2026-02-06T19:56:13.053748Z	 1967 Query	commit
2026-02-06T19:56:13.065412Z	 1962 Query	SET autocommit=0
2026-02-06T19:56:13.066118Z	 1962 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_enrolment e
         inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
         inner join kenyaemr_etl.etl_adverse_events a on e.patient_id = a.patient_id and a.form = 'vmmc-followup'
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and a.severity = 1499
2026-02-06T19:56:13.066568Z	 1962 Query	commit
2026-02-06T19:56:13.115426Z	 1962 Query	SET autocommit=0

## This query reports VMMC clients who had a circumcision in October 2025 and experienced a 
## mild adverse event recorded on the VMMC follow-up form.
2026-02-06T19:56:13.115916Z	 1962 Query	select e.patient_id
from kenyaemr_etl.etl_vmmc_enrolment e
         inner join kenyaemr_etl.etl_vmmc_circumcision_procedure c on e.patient_id = c.patient_id
         inner join kenyaemr_etl.etl_adverse_events a on e.patient_id = a.patient_id and a.form = 'vmmc-followup'
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00')
  and a.severity = 1500
2026-02-06T19:56:13.116280Z	 1962 Query	commit
2026-02-06T19:56:13.116410Z	 1962 Query	set session transaction read write
2026-02-06T19:56:13.145559Z	 1962 Query	SET autocommit=0

## This query reports VMMC clients circumcised in October 2025 who had a follow-up 
## visit within 14 days of the procedure.
2026-02-06T19:56:13.146063Z	 1962 Query	select c.patient_id from kenyaemr_etl.etl_vmmc_circumcision_procedure c
inner join kenyaemr_etl.etl_vmmc_client_followup f on c.patient_id = f.patient_id
where c.visit_date between date('2025-10-01 00:00:00') and date('2025-10-31 00:00:00') and timestampdiff(DAY ,c.visit_date,f.visit_date) <= 14
